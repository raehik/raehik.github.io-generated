<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Creating your own XMB/VSH themes for PSP custom firmware</title>
  <meta name="description" content="The PSP homebrew and hacking scene flourished from the PSP&rsquo;s release up until2011, when it was phased out and replaced with the PS Vita. Since then, a ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="raehik.github.io/2015/12/08/creating-your-own-xmbvsh-themes-for-psp-custom-firmware/">
  <link rel="alternate" type="application/rss+xml" title="Diaries of a Script Kiddie" href="raehik.github.io/feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Diaries of a Script Kiddie</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Creating your own XMB/VSH themes for PSP custom firmware</h1>
    <p class="post-meta">Dec 8, 2015</p>
  </header>

  <article class="post-content">
    <p>The PSP homebrew and hacking scene flourished from the PSP&rsquo;s release up until
2011, when it was phased out and replaced with the PS Vita. Since then, a lot of
the guides and tutorials that used to be available have been lost. Now it&rsquo;s hard
to find detailed guides for homebrew apps and such things, and the few that I
managed to find were often for older or outdated versions. So I worked on a
personal guide for something I wanted to do, and this is the result. It&rsquo;s a long
tutorial and I didn&rsquo;t edit it further, so it&rsquo;s not the easiest read &ndash; consider
yourself warned. Regardless, here&rsquo;s how to create a CTF <em>from scratch</em> and
<strong><em>using a Linux distro</em></strong> for usage with CXMB.</p>

<p>The PSP&rsquo;s main menu (called XMB for &lsquo;XrossMediaBar&rsquo;) is customisable. Sony
allowed users to create their own themes and share them, but only icons could be
changed. With CFW people have been able to access the PSP&rsquo;s flash memory and
overwrite the resource files to change more things including gameboots, sound
effects and lots more. This page is intended to be a <strong>full guide to all things
PSP theming for Linux systems</strong> (even though most programs required are
Windows&hellip;).</p>

<h2 id="definitions">Definitions</h2>

<ul>
<li><strong>PTF:</strong> PSP theme file (I&rsquo;m assuming that&rsquo;s the abbreviation) generated by
Sony&rsquo;s Custom Theme Converter. Can change icons and wallpapers, and that&rsquo;s
pretty much it.</li>
<li><strong>CTF:</strong> Custom theme file (again, assumed). Used by CXMB to override
resource files stored in the PSP&rsquo;s flash memory (flash0), without you having
to do it manually.</li>
<li><strong>RCO:</strong> Resource files stored in flash0 which contain various resources
including</li>
<li><strong>VAG:</strong> Sony&rsquo;s own audio codec, compressed sound format used in the PSX.
The PSP uses VAG files for its cursor sounds and other XMB sound effects.
Note that you <em>can</em> use both mono and stereo VAG sounds &ndash; just that some
people suggest against it, perhaps due to space considerations.</li>
<li><strong>XMB:</strong> Sony&rsquo;s XrossMediaBar, the interface used in the PSP, PS3, Sony
Bravia and maybe a few more Sony products. Can be customised to an extent.</li>
<li><strong>CXMB:</strong> Homebrew VSH plugin which allows changing more XMB elements
including sounds and icon layouts.</li>
<li><strong>VSH:</strong> The XMB internally? Not really sure. According to <a href="http://psp-handheld.blogspot.co.uk/2011/05/ctf-tool-gui-v44-create-extract-and.html">PSP
handheld</a>, <em>&ldquo;The XMB on the PSP is known internally as the
&#39;VSH&rsquo;&rdquo;</em>.</li>
</ul>

<h2 id="overview-of-the-ctf-creation-process">Overview of the CTF creation process</h2>

<p>To make a CTF (including sounds) <em>from scratch</em>, you&rsquo;d do this:</p>

<ul>
<li>Create a PTF with Custom Theme Converter

<ul>
<li>This is where you choose icons for things.</li>
</ul></li>
<li>Obtain and decrypt your PSP&rsquo;s RCOs

<ul>
<li>Requires ME CFW for the LEDA plugin to make Resurssiklunssi work</li>
</ul></li>
<li>Convert sound effects into VAG sound files with MFAudio</li>
<li>Replace any sounds in the RCOs that you want to override using RCO Editor</li>
<li>[ Do any other CTF things you like (menu placement &amp; other cool things) ]</li>
<li>Create a CTF from the PTF and RCOs using CTFtool GUI</li>
</ul>

<p>Or, a more streamlined list:</p>

<ul>
<li>Change base PTF and export (Custom Theme Converter)</li>
<li>Convert some WAVs into VAGs (MFAudio)</li>
<li>Make a copy of the RCO you are replacing VAGs in and do it (RCO Editor)</li>
<li>Create a CTF from the PTF and any RCOs (CTFtool GUI)</li>
</ul>

<p>Now I&rsquo;ll cover each of those steps.</p>

<h3 id="creating-a-ptf-using-custom-theme-converter">Creating a PTF using Custom Theme Converter</h3>

<p>Sony kept their Custom Theme Converter updated &#39;til the end: the final version
v1.6 works with 6.60 and below. (TODO: what about 6.61?)</p>

<p>Every PTF theme must have the following:</p>

<ul>
<li>Title (string)</li>
<li>Product ID (string)</li>
<li>Version (integer/float)</li>
<li>Preview Icon (16x16, 256 colour, PNG/TGA/GIM) &ndash; PNG doesn&rsquo;t work for me, I
use TGA</li>
<li>Preview Image (300x170, 24 bit colour, BMP)</li>
</ul>

<p>Title/product ID/version don&rsquo;t change a thing, and you don&rsquo;t even get to see
them on the PSP. Preview icon and image are used when selecting a theme.</p>

<p>For &#39;Preview Icon&rsquo;, using ImageMagick:</p>
<div class="highlight"><pre>convert &lt;image&gt; -resize &quot;\!16x16&quot; -colors 256 out.tga
</pre></div>
<p>For &#39;Preview Image&rsquo;, using ImageMagick:</p>
<div class="highlight"><pre>convert &lt;image&gt; -resize &quot;\!300x170&quot; BMP3:out.bmp
</pre></div>
<p>I use BMP3 because imlib2 can&rsquo;t load whatever ImageMagick uses for <code>.bmp</code> by
default. Both seem to work with Custom Theme Converter.</p>

<h3 id="obtaining-your-psp-firmware&#39;s-rcos">Obtaining your PSP firmware&rsquo;s RCOs</h3>

<p>This is for ME/PRO CFW, some strings might be different in respective VSH menus.</p>

<p>Go into the recovery menu (hit Select for the VSH menu), select &#39;Configuration&rsquo;,
and change &#39;XMB USB Device&rsquo; to Flash 0. Then connect to your PC and mount the
disk that shows up (for me it was a plain disk not partitioned):</p>
<div class="highlight"><pre>$ mkdir tmp
$ mount -o uid=$(id -u),gid=$(id -g),utf8,ro &lt;device&gt; tmp
</pre></div>
<p><em>(For some reason I couldn&rsquo;t mount properly to /mnt so I&rsquo;m giving the
instructions I used myself.)</em></p>

<p>The RCOs you want are at <code>vsh/resource</code>. Copy the whole folder over to your
computer, then change the USB device back to the memory stick.</p>

<p>Now you need to decompress them using a PSP app, Resurssiklunssi. <em>However</em>,
that is a 1.50 kernel app, which recent only old PSPs and CFWs can run (I
think). The workaround is to use LEDA, a &#39;legacy software loader&rsquo; which allows
you to run 1.50 kernel homebrew. This only works in ME CFW, so install it if you
haven&rsquo;t, run it, make sure LEDA is enabled in <code>seplugins/game.txt</code>, and start
Resurssiklunssi. Hit X, then connect back up and copy across the decompressed
file(s).</p>

<h3 id="replacing-sounds">Replacing sounds</h3>

<p>To change a sound in a CTF theme, you need to replace the sound&rsquo;s VAG file in
its respective RCO file. A lot of basic system sounds like cursor ticks and
confirmations are kept in <code>system_plugin.rco</code>, so we&rsquo;ll use that as an example.</p>

<h4 id="getting-a-wav-file">Getting a WAV file</h4>

<p>First you need a short WAV file with a frequency of <strong>44.1kHz</strong> and <strong>16 bit</strong>
depth. Usually, I&rsquo;d recommend FFmpeg:</p>
<div class="highlight"><pre>ffmpeg -i &lt;file&gt; -acodec pcm_s16le -ar 44.1k output.wav
</pre></div>
<p>Or less-assuredly, using the fact that those options are default for WAV files:</p>
<div class="highlight"><pre>ffmpeg -i &lt;file&gt; output.wav
</pre></div>
<p><strong>However</strong>, for some reason this doesn&rsquo;t work. MFAudio complains about it being
an &ldquo;invalid WAV file&rdquo;. Checking in a hex editor, FFmpeg changes the offset and
generally makes more changes than SoX, another media converter (just audio
unlike FFmpeg&rsquo;s A/V capabilities). SoX works fine, however:</p>
<div class="highlight"><pre>sox &lt;file&gt; output.wav
</pre></div>
<p>So I suggest using SoX to make your WAV files.</p>

<p>Full steps for adding a sound to a CTF theme:</p>

<p>This should be an overview, each step should be gone into in detail in
subsections.</p>

<h4 id="creating-&amp;-replacing-a-vag-file">Creating &amp; replacing a VAG file</h4>

<p>VAG (LMAO) files are a Sony compressed audio format. The PSP uses them in the
VSH for sounds. Converting to VAG isn&rsquo;t something most average audio converters
can handle, so we use <strong>MFAudio</strong> in Wine.</p>

<p>For output file format, you want &#39;VAG - Sony PSX Sound - Compressed ADPCM&rsquo;.
Stereo or mono is fine, but remember you have <strong>limited space</strong>, so in most
cases mono will be sufficient. Also, I&rsquo;ve only used mono so far &ndash; you might
have to do something different when replacing the VAG if you make it stereo.</p>

<p>To replace a VAG with the new one you&rsquo;ve just made, use RCO Editor. It&rsquo;s simple
enough.</p>

<h3 id="creating-the-ctf">Creating the CTF</h3>

<p>Now we have all the resources and files to create a CTF. CTFtool GUI (goes by
CTF Tool GUI, CTFtool GUI) conveniently lets you make CTFs on your computer
rather than using CXMB to package them, so it&rsquo;s definitely worth spending time
to set up. You&rsquo;ll have to use Wine, but CTFtool GUI plays nice with it, even
though being a little poorly designed on the GUI front messes up some window
functions.</p>

<p>The thing is, there are <strong>next to no</strong> guides out there for using CTFtool GUI,
and it requires some certain firmware files to make it produce CTFs for
different firmwares. I eventually found the answer in some thread about another
tool, CTF Manager.</p>

<p>For every firmware that you want to create CTFs for, you need <strong>3 decrypted
PRXs:</strong></p>

<ul>
<li>common_gui.prx</li>
<li>paf.prx</li>
<li>vshmain.prx</li>
</ul>

<p>CTFtool GUI comes with what seems like <em>all the main firmware files</em> for a range
of common firmwares (even though only those 3 should be required). You should be
able to create a theme for 6.61 by decrypting the required PRXs from your PSP
and putting them in the folder <code>base/661</code>.</p>

<p><strong>Don&rsquo;t panic</strong> when an error dialog comes up! CTFtool GUI is lying to you!
Every time I make a theme a &ldquo;CTF Package Error&rdquo; dialog box pops up and talks
abuot termination and whatnot. Don&rsquo;t worry, the theme should have been properly
created! Full text of the error for extra help (all spelling/grammar exact):</p>

<blockquote>
<p>CTFtool:CTF Package Error, the task termination</p>

<p>Error No.: 6
Error Description: Overflow</p>
</blockquote>

<p>As long as the CTF has been created, it&rsquo;s probably been successful.</p>

<hr>

<p>And you&rsquo;re done. Copy the CTF over to <code>ms0:/PSP/THEME</code> and try it out!</p>

<h2 id="cxmb">CXMB</h2>

<p>In earlier PSP homebrew times, to change gameboot sounds and cursor SFX you had
to directly access the PSP&rsquo;s flash memory (named flash0) and overwrite certain
resource files. This is dangerous: <a href="http://endlessparadigm.com/forum/showthread.php?tid=400">according to ZiNgA BuRgA</a>,
creator of RCO Editor, <em>&ldquo;it&rsquo;s possible to semi-brick by flashing RCOs&rdquo;</em>.
<strong>CXMB</strong> removes the need to do this by enabling you to create and use CTF
themes, which can override VSH resources in flash0 safely.</p>

<h3 id="installation">Installation</h3>

<p>To use CXMB, put the <code>cxmb.prx</code> file in <code>ms0:/cxmb</code> and add a line to
<code>ms0:/seplugins/vsh.txt</code>:</p>
<div class="highlight"><pre>ms0:/cxmb/cxmb.prx 1
</pre></div>
<h3 id="enabling-a-ctf-theme">Enabling a CTF theme</h3>

<p>Just go into Theme Settings -&gt; Theme and choose one. CTF themes aren&rsquo;t indicated
specially, so you need to know what it might look like (you don&rsquo;t actually get
shown the theme name).</p>

<h3 id="disabling-the-current-ctf-theme">Disabling the current CTF theme</h3>

<p>Changing the theme in Theme Settings to a non-CTF theme (i.e. a PTF) will only
change a few features of the theme. Like, it won&rsquo;t properly revert it. If you
want to remove the current CTF theme, delete the config file CXMB generates at
<code>ms0:/cxmb/conf.txt</code>:</p>
<div class="highlight"><pre>$ mount -o uid=$(id -u),gid=$(id -g),utf8 &lt;device&gt; /mnt
$ rm /mnt/cxmb/conf.txt
$ umount /mnt
</pre></div>
<p>Then choose the PTF theme you wanted and restart the VSH. Remember that the
wallpaper and colour would have been changed, so you need to reset them if you
choose the default theme or a PTF which doesn&rsquo;t change those.</p>

<h2 id="ctftool-gui">CTFtool GUI</h2>

<p>To extract resources from <strong>PTFs</strong>, use the top two fields in the &#39;Extract&rsquo; tab.
For <strong>CTFs</strong>, use the bottom two fields.</p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Diaries of a Script Kiddie</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Diaries of a Script Kiddie</li>
          <li><a href="mailto:thefirstmuffinman@gmail.com">thefirstmuffinman@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/raehik">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">raehik</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/raehik">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">raehik</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Musings and guides on tech with a Linux slant.</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
